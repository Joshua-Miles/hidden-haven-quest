<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"/>
    </head>
    <body>
        <canvas ></canvas>
        <h1>Lets Go!!!</h1>
        <script src="jsQR.js"></script>
        <script>
            (async function(){ 
                alert('before')
                navigator.mediaDevices.getUserMedia({video: true })
                    .then( mediaStream => {
                        alert('this far')
                        let search = async function(){
                        try {

                            const track = mediaStream.getVideoTracks()[0];
                            let imageCapture = new ImageCapture(track);
                            let bitmap = await imageCapture.grabFrame()
                            let width = bitmap.width
                            let height = bitmap.height
                            const canvas = document.querySelector("canvas");
                            const ctx = canvas.getContext("2d");
                            canvas.width =  width;
                            canvas.height = height;
                            ctx.drawImage(bitmap, 0, 0, width, height);
                            let imageData = ctx.getImageData(0, 0, width, height);
                            let code = jsQR(imageData.data, width, height)
                            if(!code) setTimeout(search, 10)
                            else {
                                alert(code.data)
                            }
                        } catch(err){
                            alert(err)
                        }
                    }
                    search()
                })
                .catch( error => {
                    alert('in here?')
                })
                alert('after')
            })()
        </script>
    </body>
    
</html>