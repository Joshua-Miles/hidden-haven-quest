<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"/>
    </head>
    <body>
        <canvas ></canvas>
        <h1>Lets Go!!!</h1>
        <script src="jsQR.js"></script>
        <script>
            (async function(){ 
                navigator.mediaDevices.getUserMedia({video: { facingMode: { exact: "environment" } } })
                    .then( mediaStream => {
                        let search = async function(){
                            const track = mediaStream.getVideoTracks()[0];
                            let imageCapture = new ImageCapture(track);
                            alert(imageCapture)
                            let bitmap = await imageCapture.grabFrame()
                            alert(bitmap)
                            let width = bitmap.width
                            let height = bitmap.height
                            const canvas = document.querySelector("canvas");
                            const ctx = canvas.getContext("2d");
                            canvas.width =  width;
                            canvas.height = height;
                            ctx.drawImage(bitmap, 0, 0, width, height);
                            let imageData = ctx.getImageData(0, 0, width, height);
                            let code = jsQR(imageData.data, width, height)
                            if(!code) setTimeout(search, 10)
                            else {
                                alert(code.data)
                            }
                        
                        }
                        search()
                    })
                    .catch( error => {
                        alert('in here?')
                    })
            
            })()
        </script>
    </body>
    
</html>